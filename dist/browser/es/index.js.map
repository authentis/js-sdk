{"version":3,"file":"index.js","sources":["../../../src/client.js","../../../src/browser/index.js"],"sourcesContent":["function captcha() {\n  return {\n    handshake: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/captcha'\n    }),\n    verify: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/captcha'\n    })\n  }\n}\n\nfunction auth() {\n  return {\n    state: this.createRequest.call(this, {\n      method: 'GET',\n      path: '/auth/state'\n    }),\n    session: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/auth/session'\n    }),\n    epwd: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/auth/signin/epwd'\n    }),\n    epwdv: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/auth/signin/epwd'\n    }),\n    eotp: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/auth/signin/eotp'\n    }),\n    eotpv: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/auth/signin/eotp'\n    }),\n    potp: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/auth/signin/potp'\n    }),\n    potpv: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/auth/signin/potp'\n    }),\n    revoke: this.createRequest.call(this, {\n      method: 'DELETE',\n      path: '/auth/revoke'\n    })\n  }\n}\n\nfunction organization() {\n  return {\n    create: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/org'\n    }),\n    update: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/org'\n    }),\n    get: this.createRequest.call(this, {\n      method: 'GET',\n      path: '/org'\n    }),\n    remove: this.createRequest.call(this, {\n      method: 'DELETE',\n      path: '/org'\n    })\n  }\n}\n\nfunction project() {\n  return {\n    create: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/project'\n    }),\n    update: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/project'\n    }),\n    get: this.createRequest.call(this, {\n      method: 'GET',\n      path: '/project'\n    }),\n    remove: this.createRequest.call(this, {\n      method: 'DELETE',\n      path: '/project'\n    }),\n    signinMethod: {\n      create: this.createRequest.call(this, {\n        method: 'POST',\n        path: '/project/signin-method'\n      }),\n      update: this.createRequest.call(this, {\n        method: 'PUT',\n        path: '/project/signin-method'\n      }),\n      get: this.createRequest.call(this, {\n        method: 'GET',\n        path: '/project/signin-method'\n      }),\n      remove: this.createRequest.call(this, {\n        method: 'DELETE',\n        path: '/project/signin-method'\n      })\n    }\n  }\n}\n\nfunction app() {\n  return {\n    create: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/app'\n    }),\n    update: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/app'\n    }),\n    get: this.createRequest.call(this, {\n      method: 'GET',\n      path: '/app'\n    }),\n    remove: this.createRequest.call(this, {\n      method: 'DELETE',\n      path: '/app'\n    })\n  }\n}\n\nfunction invitation() {\n  return {\n    create: this.createRequest.call(this, {\n      method: 'POST',\n      path: '/invitation'\n    }),\n    get: this.createRequest.call(this, {\n      method: 'GET',\n      path: '/invitation'\n    }),\n    remove: this.createRequest.call(this, {\n      method: 'DELETE',\n      path: '/invitation'\n    })\n  }\n}\n\nfunction device() {\n  return {\n    inspect: this.createRequest.call(this, {\n      method: 'PUT',\n      path: '/device'\n    })\n  }\n}\n\nexport default function Authentis(userConfig) {\n  this.config = {\n    host: userConfig.host || 'https://auth.gozel.com.tr',\n    version: userConfig.version || null,\n    projectIdentifier: userConfig.projectIdentifier || '',\n    projectLocale: userConfig.locale || '',\n    token: userConfig.token || null,\n    clientId: userConfig.clientId || null,\n    clientSecret: userConfig.clientSecret || null\n  }\n\n  this.setLastResponse = function(resp) {\n    this.lastResponse = resp\n  }\n  this.getLastResponse = function() {\n    return this.lastResponse\n  }\n\n  this.createAuthHeader = function createAuthHeader(obj) {\n    if (obj.token) {\n      return 'Bearer ' + obj.token\n    }\n    else if (obj.clientId && obj.clientSecret) {\n      return 'Basic ' + btoa(obj.clientId + ':' + obj.clientSecret)\n    }\n    else {\n      return ''\n    }\n  }\n\n  this.createHeaders = function createHeaders(obj) {\n    return Object.assign({},\n      {\n        'Accept': 'application/json',\n        'Cache-Control': 'no-cache',\n        'Pragma': 'no-cache',\n      },\n      ['POST', 'PUT'].indexOf(obj.method) !== -1\n        ? {'Content-Type': 'application/json'}\n        : {},\n      {'Authorization': this.createAuthHeader(this.config)},\n      this.config.projectIdentifier\n        ? {'Authentis-Project-Identifier': this.config.projectIdentifier}\n        : {},\n      this.config.projectLocale\n        ? {'Authentis-Project-Locale': this.config.projectLocale}\n        : {}\n    )\n  }\n\n  return {\n    getLastResponse: this.getLastResponse.bind(this),\n    captcha: captcha.apply(this),\n    auth: auth.apply(this),\n    organization: organization.apply(this),\n    project: project.apply(this),\n    app: app.apply(this),\n    device: device.apply(this)\n  }\n}\n","import authentis from '../client'\n\nexport function createRequest(params) {\n  const self = this\n  const mayHaveBody = ['POST', 'PUT'].indexOf(params.method) !== -1\n  const requestOpts = {\n    method: params.method,\n    credentials: 'same-origin',\n    mode: 'cors',\n    headers: self.createHeaders.call(self, params)\n  }\n\n  return async function req(opts={}) {\n    const url = new URL(params.path, self.config.host)\n\n    if (opts.path && Array.isArray(opts.path)) {\n      url.pathname += '/' + opts.path.join('/')\n    }\n\n    if (opts.searchParams) {\n      Object.keys(opts.searchParams).map(param => url.searchParams.set(param, opts.searchParams[param]))\n    }\n\n    if (opts.id) {\n      if (/[^a-zA-Z0-9-]+/.test(opts.id)) {\n        return {error: {code: 'REQUEST_ERROR', details: 'Invalid identifier.'}}\n      }\n      url.pathname = params.path + '/' + opts.id\n    }\n\n    if (opts.body) {\n      if (Object.prototype.toString.call(opts.body) === '[object Object]') {\n        requestOpts.body = JSON.stringify(opts.body)\n      }\n      else {\n        requestOpts.body = opts.body\n      }\n    }\n\n    try {\n      const resp = await fetch(url, requestOpts)\n\n      self.setLastResponse.call(self, resp)\n\n      const obj = await resp.json()\n\n      return obj\n    } catch (e) {\n      return {error: {code: 'REQUEST_ERROR'}}\n    }\n  }\n}\n\nexport function configure(userConfig={}) {\n  return authentis.call({createRequest}, userConfig)\n}\n"],"names":["captcha","handshake","this","createRequest","call","method","path","verify","auth","state","session","epwd","epwdv","eotp","eotpv","potp","potpv","revoke","organization","create","update","get","remove","project","signinMethod","app","device","inspect","Authentis","userConfig","config","host","version","projectIdentifier","projectLocale","locale","token","clientId","clientSecret","setLastResponse","resp","lastResponse","getLastResponse","createAuthHeader","obj","btoa","createHeaders","_Object$assign","_indexOfInstanceProperty","bind","apply","params","self","requestOpts","credentials","mode","headers","opts","url","Array","isArray","pathname","join","searchParams","param","set","id","test","error","code","details","body","Object","prototype","toString","_JSON$stringify","fetch","json","configure","authentis"],"mappings":"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"}